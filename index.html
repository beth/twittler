<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type = "text/css" href="style.css">
  </head>
  <body>
    <script>
    	
    var formatDate = function(dateString)
    {
    var newDate = new Date(dateString);
    var mins = (newDate.getMinutes()<9) ? '0' + newDate.getMinutes() : newDate.getMinutes();
    var formattedDateString = (newDate.getMonth()+1) + '/' + newDate.getDate() + '/' + newDate.getFullYear() + ' ' + newDate.getHours() + ':' + mins;
    return formattedDateString;
    };
    
      $(document).ready(function(){
      	//create jquery variable for body, clear body
        var $body = $('body');
        $body.html('');
        //create button
        var button = $('<button type="button">Update Tweets</button>');
        $body.prepend(button); 
        var $button = $('button');
        
        //Will use this to post all tweets, both initial and update
        var postTweets = function(start,stop){
        	while(start<=stop)
        	{
        		var tweet = streams.home[start];
        		var $tweet = $('<div data-user = ' + tweet.user + ' class=\'tweet ' + tweet.user + '\'></div>');
        		$tweet.text('@' + tweet.user + '(' + formatDate(tweet.created_at) + ')' + ': ' + tweet.message);
        		$button.after($tweet);
        		start += 1;
        	}
        }
        
        //First post of tweets
        var start = 0;
        var stop = streams.home.length-1;
        postTweets(start, stop);
		
		//For refreshing tweets
		$button.click(function(){
			start = stop+1;
			stop = streams.home.length-1;
			postTweets(start,stop);
		});
		
		$body.on('click','.tweet',function(){
			//alert('click');
			//alert(this);
			var user = $(this).data('user');
			//alert('clicked ' + user);
			$button.nextAll().remove();
			
			var curr = 0;
			var last = streams.home.length-1;
			while(curr<=last)
        	{
        		var tweet = streams.home[curr];
        		if(tweet.user == user)
        		{
        		var $tweet = $('<div data-user = ' + tweet.user + ' class=\'tweet ' + tweet.user + '\'></div>');
        		$tweet.text('@' + tweet.user + '(' + formatDate(tweet.created_at) + ')' + ': ' + tweet.message);
        		$button.after($tweet);
        		}
        		curr += 1;
        	}
		
		});
      });

    </script>
  </body>
</html>
